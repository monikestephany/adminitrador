var table;
var json2 = { 
    "Pesquisas":[ 
        { 
           "Nome Completo":"NEIDE APARECIDA LIMA",
           "RG":"506712308",
           "Data de emissão do RG":"2008-09-04",
           "Sexo":"F",
           "CPF":"4472912899",
           "Informação SAP":"NAO CONSTA",
           "Informação de Captura":"NAO CONSTA",
           "Naturalidade":"S.PAULO -SP",
           "Nascido em":"1962-10-03",
           "Situação":"OK",
           "Complemento do RG":"",
           "CNH Número":868311610,
           "CNH Categoria":"B",
           "CNH Data Emissão":"2014-09-19",
           "CNH Data Vencimento":"2014-09-17",
           "CNH Espelho":949298287,
           "Nome Pai":"NILSON DOS SANTOS",
           "Nome Mãe":"IEDA RANGEL LIMA",
           "Cor de Olhos":"CAST.CLAROS",
           "Cor da Pele":"PRETA .",
           "Cor dos Cabelos":"CAST.CLAROS"
        },
        { 
           "Nome Completo":"NEIDE APARECIDA LIMA",
           "RG":"506712308",
           "Data de emissão do RG":"2008-09-04",
           "Sexo":"F",
           "CPF":"4472912899",
           "Informação SAP":"NAO CONSTA",
           "Informação de Captura":"NAO CONSTA",
           "Naturalidade":"S.PAULO -SP",
           "Nascido em":"1962-10-03",
           "Situação":"OK",
           "Complemento do RG":"",
           "CNH Número":868311610,
           "CNH Categoria":"B",
           "CNH Data Emissão":"2014-09-19",
           "CNH Data Vencimento":"2014-09-17",
           "CNH Espelho":949298287,
           "Nome Pai":"NILSON DOS SANTOS",
           "Nome Mãe":"IEDA RANGEL LIMA",
           "Cor de Olhos":"CAST.CLAROS",
           "Cor da Pele":"PRETA .",
           "Cor dos Cabelos":"CAST.CLAROS"
        },
        { 
           "Nome Completo":"NEIDE APARECIDA LIMA",
           "RG":"506712308",
           "Data de emissão do RG":"2008-09-04",
           "Sexo":"F",
           "CPF":"4472912899",
           "Informação SAP":"NAO CONSTA",
           "Informação de Captura":"NAO CONSTA",
           "Naturalidade":"S.PAULO -SP",
           "Nascido em":"1962-10-03",
           "Situação":"OK",
           "Complemento do RG":"",
           "CNH Número":868311610,
           "CNH Categoria":"B",
           "CNH Data Emissão":"2014-09-19",
           "CNH Data Vencimento":"2014-09-17",
           "CNH Espelho":949298287,
           "Nome Pai":"NILSON DOS SANTOS",
           "Nome Mãe":"IEDA RANGEL LIMA",
           "Cor de Olhos":"CAST.CLAROS",
           "Cor da Pele":"PRETA .",
           "Cor dos Cabelos":"CAST.CLAROS"
        },
        { 
           "Nome Completo":"NEIDE APARECIDA LIMA",
           "RG":"506712308",
           "Data de emissão do RG":"2008-09-04",
           "Sexo":"F",
           "CPF":"4472912899",
           "Informação SAP":"NAO CONSTA",
           "Informação de Captura":"NAO CONSTA",
           "Naturalidade":"S.PAULO -SP",
           "Nascido em":"1962-10-03",
           "Situação":"OK",
           "Complemento do RG":"",
           "CNH Número":868311610,
           "CNH Categoria":"B",
           "CNH Data Emissão":"2014-09-19",
           "CNH Data Vencimento":"2014-09-17",
           "CNH Espelho":949298287,
           "Nome Pai":"NILSON DOS SANTOS",
           "Nome Mãe":"IEDA RANGEL LIMA",
           "Cor de Olhos":"CAST.CLAROS",
           "Cor da Pele":"PRETA .",
           "Cor dos Cabelos":"CAST.CLAROS"
        },
        { 
           "Nome Completo":"NEIDE APARECIDA LIMA",
           "RG":"506712308",
           "Data de emissão do RG":"2008-09-04",
           "Sexo":"F",
           "CPF":"4472912899",
           "Informação SAP":"NAO CONSTA",
           "Informação de Captura":"NAO CONSTA",
           "Naturalidade":"S.PAULO -SP",
           "Nascido em":"1962-10-03",
           "Situação":"OK",
           "Complemento do RG":"",
           "CNH Número":868311610,
           "CNH Categoria":"B",
           "CNH Data Emissão":"2014-09-19",
           "CNH Data Vencimento":"2014-09-17",
           "CNH Espelho":949298287,
           "Nome Pai":"NILSON DOS SANTOS",
           "Nome Mãe":"IEDA RANGEL LIMA",
           "Cor de Olhos":"CAST.CLAROS",
           "Cor da Pele":"PRETA .",
           "Cor dos Cabelos":"CAST.CLAROS"
        },
        { 
           "Nome Completo":"NEIDE APARECIDA LIMA",
           "RG":"506712308",
           "Data de emissão do RG":"2008-09-04",
           "Sexo":"F",
           "CPF":"4472912899",
           "Informação SAP":"NAO CONSTA",
           "Informação de Captura":"NAO CONSTA",
           "Naturalidade":"S.PAULO -SP",
           "Nascido em":"1962-10-03",
           "Situação":"OK",
           "Complemento do RG":"",
           "CNH Número":868311610,
           "CNH Categoria":"B",
           "CNH Data Emissão":"2014-09-19",
           "CNH Data Vencimento":"2014-09-17",
           "CNH Espelho":949298287,
           "Nome Pai":"NILSON DOS SANTOS",
           "Nome Mãe":"IEDA RANGEL LIMA",
           "Cor de Olhos":"CAST.CLAROS",
           "Cor da Pele":"PRETA .",
           "Cor dos Cabelos":"CAST.CLAROS"
        },
        { 
           "Nome Completo":"NEIDE APARECIDA LIMA",
           "RG":"506712308",
           "Data de emissão do RG":"2008-09-04",
           "Sexo":"F",
           "CPF":"4472912899",
           "Informação SAP":"NAO CONSTA",
           "Informação de Captura":"NAO CONSTA",
           "Naturalidade":"S.PAULO -SP",
           "Nascido em":"1962-10-03",
           "Situação":"OK",
           "Complemento do RG":"",
           "CNH Número":868311610,
           "CNH Categoria":"B",
           "CNH Data Emissão":"2014-09-19",
           "CNH Data Vencimento":"2014-09-17",
           "CNH Espelho":949298287,
           "Nome Pai":"NILSON DOS SANTOS",
           "Nome Mãe":"IEDA RANGEL LIMA",
           "Cor de Olhos":"CAST.CLAROS",
           "Cor da Pele":"PRETA .",
           "Cor dos Cabelos":"CAST.CLAROS"
        },
        { 
           "Nome Completo":"NEIDE APARECIDA LIMA",
           "RG":"506712308",
           "Data de emissão do RG":"2008-09-04",
           "Sexo":"F",
           "CPF":"4472912899",
           "Informação SAP":"NAO CONSTA",
           "Informação de Captura":"NAO CONSTA",
           "Naturalidade":"S.PAULO -SP",
           "Nascido em":"1962-10-03",
           "Situação":"OK",
           "Complemento do RG":"",
           "CNH Número":868311610,
           "CNH Categoria":"B",
           "CNH Data Emissão":"2014-09-19",
           "CNH Data Vencimento":"2014-09-17",
           "CNH Espelho":949298287,
           "Nome Pai":"NILSON DOS SANTOS",
           "Nome Mãe":"IEDA RANGEL LIMA",
           "Cor de Olhos":"CAST.CLAROS",
           "Cor da Pele":"PRETA .",
           "Cor dos Cabelos":"CAST.CLAROS"
        },
        { 
           "Nome Completo":"NEIDE APARECIDA LIMA",
           "RG":"506712308",
           "Data de emissão do RG":"2008-09-04",
           "Sexo":"F",
           "CPF":"4472912899",
           "Informação SAP":"NAO CONSTA",
           "Informação de Captura":"NAO CONSTA",
           "Naturalidade":"S.PAULO -SP",
           "Nascido em":"1962-10-03",
           "Situação":"OK",
           "Complemento do RG":"",
           "CNH Número":868311610,
           "CNH Categoria":"B",
           "CNH Data Emissão":"2014-09-19",
           "CNH Data Vencimento":"2014-09-17",
           "CNH Espelho":949298287,
           "Nome Pai":"NILSON DOS SANTOS",
           "Nome Mãe":"IEDA RANGEL LIMA",
           "Cor de Olhos":"CAST.CLAROS",
           "Cor da Pele":"PRETA .",
           "Cor dos Cabelos":"CAST.CLAROS"
        },
        { 
           "Nome Completo":"NEIDE APARECIDA LIMA",
           "RG":"506712308",
           "Data de emissão do RG":"2008-09-04",
           "Sexo":"F",
           "CPF":"4472912899",
           "Informação SAP":"NAO CONSTA",
           "Informação de Captura":"NAO CONSTA",
           "Naturalidade":"S.PAULO -SP",
           "Nascido em":"1962-10-03",
           "Situação":"OK",
           "Complemento do RG":"",
           "CNH Número":868311610,
           "CNH Categoria":"B",
           "CNH Data Emissão":"2014-09-19",
           "CNH Data Vencimento":"2014-09-17",
           "CNH Espelho":949298287,
           "Nome Pai":"NILSON DOS SANTOS",
           "Nome Mãe":"IEDA RANGEL LIMA",
           "Cor de Olhos":"CAST.CLAROS",
           "Cor da Pele":"PRETA .",
           "Cor dos Cabelos":"CAST.CLAROS"
        }
     ]
 };

var json = {
    "Pesquisas": [{"Nome Completo":"NEIDE APARECIDA LIMA","RG":"506712308","CPF":"4472912899","Situação":"OK"},{"Nome Completo":"NEIDE APARECIDA LIMA","RG":"506712308","CPF":"4472912899","Situação":"OK"},{"Nome Completo":"NEIDE APARECIDA LIMA","RG":"506712308","CPF":"4472912899","Situação":"OK"},{"Nome Completo":"NEIDE APARECIDA LIMA","RG":"506712308","CPF":"4472912899","Situação":"OK"},{"Nome Completo":"NEIDE APARECIDA LIMA","RG":"506712308","CPF":"4472912899","Situação":"OK"},{"Nome Completo":"NEIDE APARECIDA LIMA","RG":"506712308","CPF":"4472912899","Situação":"OK"},{"Nome Completo":"NEIDE APARECIDA LIMA","RG":"506712308","CPF":"4472912899","Situação":"OK"},{"Nome Completo":"NEIDE APARECIDA LIMA","RG":"506712308","CPF":"4472912899","Situação":"OK"},{"Nome Completo":"NEIDE APARECIDA LIMA","RG":"506712308","CPF":"4472912899","Situação":"OK"},{"Nome Completo":"NEIDE APARECIDA LIMA","RG":"506712308","CPF":"4472912899","Situação":"OK"}] 

};
var jsonPolicial = {
    "Pesquisas": [{"CPF":"89272089000","Posto/Graduação":"1º TENENTE","RE":"100333","Nome Completo":"BRUNO SOUZA FERREIRA","OPM":"DTIC","Situação":"Ativo"},
    {"CPF":"27415997000","Posto/Graduação":"1º TENENTE","RE":"100123","Nome Completo":"CAIO SOUZA FERREIRA","OPM":"DTIC","Situação":"Ativo"},
    {"CPF":"87081597009","Posto/Graduação":"1º CAPITÃO PM","RE":"100231","Nome Completo":"JULIO SOUZA FERREIRA","OPM":"DTIC","Situação":"Ativo"},
    {"CPF":"73504740086","Posto/Graduação":"SOLDADO PM","RE":"100311","Nome Completo":"DIEGO SOUZA FERREIRA","OPM":"DTIC","Situação":"Ativo"},
    {"CPF":"24497723089","Posto/Graduação":"SOLDADO PM","RE":"100365","Nome Completo":"RENAN SOUZA FERREIRA","OPM":"DTIC","Situação":"Inativo"},
    {"CPF":"12867876028","Posto/Graduação":"SOLDADO PM","RE":"100338","Nome Completo":"BRUNA SOUZA FERREIRA","OPM":"DTIC","Situação":"Ativo"},
    {"CPF":"43489139003","Posto/Graduação":"SOLDADO PM","RE":"100382","Nome Completo":"BIANCA SOUZA FERREIRA","OPM":"DTIC","Situação":"Ativo"},
    {"CPF":"39809394055","Posto/Graduação":"SOLDADO PM","RE":"100152","Nome Completo":"MONIKE SOUZA FERREIRA","OPM":"DTIC","Situação":"Ativo"},
    {"CPF":"10968280064","Posto/Graduação":"SOLDADO PM","RE":"100363","Nome Completo":"RICARDO SOUZA FERREIRA","OPM":"DTIC","Situação":"Ativo"},
    {"CPF":"43069998070","Posto/Graduação":"SOLDADO PM","RE":"100397","Nome Completo":"RENATO SOUZA FERREIRA","OPM":"DTIC","Situação":"Inativo"}]   
};
var jsonPessoa = {
    "Pesquisas": [{"Nome Completo":"NEIDE APARECIDA LIMA","RG":"506712308","CPF":"4472912899","Situação":"OK"},{"Nome Completo":"NEIDE APARECIDA LIMA","RG":"506712308","CPF":"4472912899","Situação":"OK"},{"Nome Completo":"NEIDE APARECIDA LIMA","RG":"506712308","CPF":"4472912899","Situação":"OK"},{"Nome Completo":"NEIDE APARECIDA LIMA","RG":"506712308","CPF":"4472912899","Situação":"OK"},{"Nome Completo":"NEIDE APARECIDA LIMA","RG":"506712308","CPF":"4472912899","Situação":"OK"},{"Nome Completo":"NEIDE APARECIDA LIMA","RG":"506712308","CPF":"4472912899","Situação":"OK"},{"Nome Completo":"NEIDE APARECIDA LIMA","RG":"506712308","CPF":"4472912899","Situação":"OK"},{"Nome Completo":"NEIDE APARECIDA LIMA","RG":"506712308","CPF":"4472912899","Situação":"OK"},{"Nome Completo":"NEIDE APARECIDA LIMA","RG":"506712308","CPF":"4472912899","Situação":"OK"},{"Nome Completo":"NEIDE APARECIDA LIMA","RG":"506712308","CPF":"4472912899","Situação":"OK"}] 

};
var jsonVeiculo = {
    "Pesquisas": [{"Placa":"FRG785","Marca":"Hyundai","Modelo":"Elantra","Cor":"Vermelha","Ano":"2016","Situação":"ROUBO"},
    {"Placa":"FHY755","Marca":"Hyundai","Modelo":"Tucson","Cor":"Vermelha","Ano":"2019","Situação":"ROUBO"},
    {"Placa":"FJK305","Marca":"Hyundai","Modelo":"Santa Fe","Cor":"Vermelha","Ano":"2018","Situação":"ROUBO"},
    {"Placa":"FUU157","Marca":"Honda","Modelo":"Civic","Cor":"Azul","Ano":"2019","Situação":"ROUBO"},
    {"Placa":"FXX731","Marca":"Honda","Modelo":"Fit","Cor":"Branco","Ano":"2018","Situação":"ROUBO"},
    {"Placa":"FRG783","Marca":"Volkswagen","Modelo":"Golf","Cor":"Branco","Ano":"2018","Situação":"ROUBO"},
    {"Placa":"FRC736","Marca":"Volkswagen","Modelo":"Passat","Cor":"Preto","Ano":"2016","Situação":"ROUBO"},
    {"Placa":"FDC365","Marca":"Chevrolet","Modelo":"Camaro","Cor":"Preto","Ano":"2016","Situação":"ROUBO"},
    {"Placa":"FDF792","Marca":"Chevrolet","Modelo":"Cruze","Cor":"Prata","Ano":"2016","Situação":"ROUBO"},
    {"Placa":"FRD722","Marca":"Chevrolet","Modelo":"Onix","Cor":"Prata","Ano":"2019","Situação":"ROUBO"}]
};
var jsonBicicleta = {
    "Pesquisas": [{"Serie/Quadro":"781/18","Marca":"Mountain","Inf. Comp.":"","BO":"1021/2019","Orgão":"Polícia Militar","Data/Hora":"2019-09-12 12:00:00","Situação":"ROUBO"},
    {"0/Quadro":"782/12","Marca":"Mountain","Inf. Comp.":"","BO":"1022/2019","Orgão":"Polícia Militar","Data/Hora":"2019-09-25 12:00:00","Situação":"ROUBO"},
    {"Serie/Quadro":"783/21","Marca":"Mountain","Inf. Comp.":"","BO":"1023/2019","Orgão":"Polícia Militar","Data/Hora":"2019-09-16 12:00:00","Situação":"ROUBO"},
    {"Serie/Quadro":"784/12","Marca":"Caloi","Inf. Comp.":"","BO":"1024/2019","Orgão":"Polícia Militar","Data/Hora":"2019-09-19 12:00:00","Situação":"ROUBO"},
    {"Serie/Quadro":"785/18","Marca":"Caloi","Inf. Comp.":"","BO":"1025/2019","Orgão":"Polícia Militar","Data/Hora":"2019-09-15 12:00:00","Situação":"ROUBO"},
    {"Serie/Quadro":"786/12","Marca":"Caloi","Inf. Comp.":"","BO":"1026/2019","Orgão":"Polícia Militar","Data/Hora":"2019-09-14 12:00:00","Situação":"ROUBO"},
    {"Serie/Quadro":"787/21","Marca":"Audax","Inf. Comp.":"","BO":"1027/2019","Orgão":"Polícia Militar","Data/Hora":"2019-09-11 12:00:00","Situação":"ROUBO"},
    {"Serie/Quadro":"788/18","Marca":"Audax","Inf. Comp.":"","BO":"1028/2019","Orgão":"Polícia Militar","Data/Hora":"2019-09-09 12:00:00","Situação":"ROUBO"},
    {"Serie/Quadro":"789/12","Marca":"Audax","Inf. Comp.":"","BO":"1029/2019","Orgão":"Polícia Militar","Data/Hora":"2019-09-08 12:00:00","Situação":"ROUBO"}]
};
var jsonImei = {
    "Pesquisas": [{ "IMEI":"3123710830568325","Marca":"SAMSUNG GALAXY J6 METAL","BO":"1057/2019","Orgão":"Polícia Militar","Data/Hora":"2019-01-09 01:19:00","Situação":"ROUBO"},
    { "IMEI":"3519710830568325","Marca":"SAMSUNG GALAXY J7 METAL","BO":"1057/2019","Orgão":"Polícia Militar","Data/Hora":"2019-01-09 01:19:00","Situação":"ROUBO"},
    { "IMEI":"3123710830568325","Marca":"SAMSUNG GALAXY J7 METAL","BO":"1057/2019","Orgão":"Polícia Militar","Data/Hora":"2019-01-09 01:19:00","Situação":"ROUBO"},
    { "IMEI":"3519710830568814","Marca":"SAMSUNG GALAXY J7 METAL","BO":"1057/2019","Orgão":"Polícia Militar","Data/Hora":"2019-01-09 01:19:00","Situação":"ROUBO"},
    { "IMEI":"31237108305986715","Marca":"SAMSUNG GALAXY J6 METAL","BO":"1057/2019","Orgão":"Polícia Militar","Data/Hora":"2019-01-09 01:19:00","Situação":"ROUBO"},
    { "IMEI":"351971083056884","Marca":"SAMSUNG GALAXY J7 METAL","BO":"1057/2019","Orgão":"Polícia Militar","Data/Hora":"2019-01-02 01:19:00","Situação":"ROUBO"},
    { "IMEI":"351971083056884","Marca":"SAMSUNG GALAXY J7 METAL","BO":"1057/2019","Orgão":"Polícia Militar","Data/Hora":"2019-01-09 01:19:00","Situação":"ROUBO"},
    { "IMEI":"351971083056884","Marca":"SAMSUNG GALAXY J7 METAL","BO":"1057/2019","Orgão":"Polícia Militar","Data/Hora":"2019-01-06 01:19:00","Situação":"ROUBO"},
    { "IMEI":"351971083056884","Marca":"SAMSUNG GALAXY J7 METAL","BO":"1057/2019","Orgão":"Polícia Militar","Data/Hora":"2019-01-01 01:19:00","Situação":"ROUBO"},
    { "IMEI":"351971083056884","Marca":"SAMSUNG GALAXY J7 METAL","BO":"1057/2019","Orgão":"Polícia Militar","Data/Hora":"2019-01-01 01:19:00","Situação":"ROUBO"}]
};

function jsonConvertTable(item, targetTable, targetFilter, itemType) {
    loadingStuff(targetTable.parent());
    //debugger;
    itemType = itemType;
    var tableH = [];
    var tableB = [];
    var rowB = [];
    var TipoPesquisa = itemType;
    var tableF = [];1
    tableF['Policial'] = [];
    tableF['Nenhum'] = [];
    tableF['Arma'] = [];
    tableF['Veiculo'] = [];
    tableF['Pessoa'] = [];
    tableF['Policial Militar'] = [];
    tableF['Condutor Infoseg'] = [];
    tableF['Aparelho Movel'] = [];
    tableF['Bicicleta'] = [];
    tableF['Imei'] = [];
    var count = 0;
    $.each(item, function(key, value){
        //TipoPesquisa = value['tipoPesquisa'];
        //console.log(value);
        /*
        0 = Nenhum
        1 = Arma,
        2 = Veiculo,
        3 = Pessoa,
        4 = Policial_Militar,
        5 = Condutor_Infoseg,
        6 = Aparelho_Movel,
        7 = Bicicleta,
        8 = Imei
        */
        $.each(value, function(chave, valor){
            if(chave == 'TipoPesquisa'){
                TipoPesquisa = valor;
                //console.log(TipoPesquisa);
            }
            if(chave == "Propriedades"){
                $.each(valor, function(propTit, propVal){
                    tableH.indexOf(propTit) === -1 ? tableH.push(propTit) : console.log('Item já existente: '+propTit);
                    switch(TipoPesquisa){
                        case 0: tableF['Nenhum'][tableH.indexOf(propTit)] = propTit; break;
                        case 1: tableF['Arma'][tableH.indexOf(propTit)] = propTit; break;
                        case 2: tableF['Veiculo'][tableH.indexOf(propTit)] = propTit; break;
                        case 3: tableF['Pessoa'][tableH.indexOf(propTit)] = propTit; break;
                        case 4: tableF['Policial Militar'][tableH.indexOf(propTit)] = propTit; break;
                        case 5: tableF['Condutor Infoseg'][tableH.indexOf(propTit)] = propTit; break;
                        case 6: tableF['Imei'][tableH.indexOf(propTit)] = propTit; break;
                        case 7: tableF['Bicicleta'][tableH.indexOf(propTit)] = propTit; break;
                           
                    }
                    
                    count++;
                });
            } else {
                //console.log(tableH.indexOf(chave));
                tableH.indexOf(chave) === -1 ? tableH.push(chave) : console.log('Item já existente: '+chave);
                tableF['Policial'][tableH.indexOf(chave)] = chave;
                count++;
            }
        })
    })

    console.log(tableF);
    console.log(tableH);
    //createTable($('.FinalTable'), tableH, tableB);
    var obj = [];
    $.each(tableH, function(key, value){  // cria um array com base em todos os Titulos 
        obj[value] = "";
    });
    $.each(item, function(key, value){
       $.each(value, function(chave, valor){
           if(chave == "Propriedades"){
                $.each(valor, function(propChave, propVal){

                    obj[propChave] = propVal;
                });
           } else{
            
            if(chave == "TipoPesquisa"){
                
                switch(valor){
                    case 0: obj[chave] = 'Nenhum'; break;
                    case 1: obj[chave] = 'Arma'; break;
                    case 2: obj[chave] = 'Veiculo'; break;
                    case 3: obj[chave] = 'Pessoa'; break;
                    case 4: obj[chave] = 'Policial Militar'; break;
                    case 5: obj[chave] = 'Condutor Infoseg'; break;
                    case 6: obj[chave] = 'Imei'; break;
                    case 7: obj[chave] = 'Bicicleta'; break;
                        
                }
            } else{
                obj[chave] = valor;
            }
           }
       });
       tableB.push(obj);
       obj = [];
        $.each(tableH, function(key, value){  // cria um array com base em todos os Titulos 
            obj[value] = "";
        });
    });
    //console.log(tableB);
    //console.log(tableF);
    if(targetFilter.length > 0){
        createFilters(targetFilter, tableF);
    }
    createTable(targetTable, tableH, tableB, itemType);
    disableFilters();
    loadingStuff(targetTable.parent());
};

// Função para criar uma nova tabela
// target: elemento aonde a tabela será gerada
// tableH: títulos da tabela
// tableB: conteúdo da tabela
var storeFilters = [];
function createFilters(target, tableF){
    htmlButtons = '';
    console.log(tableF);
    count = 0;
    //target.append('<div class="policial"><span toggled="0">Titulo</span><div class="btns"></div></div>');
    for (var chave in tableF) {
        if(tableF[chave].length > 0){
            target.append('<div class="'+chave+'"><span toggled="0">'+chave+'</span><div class="btns"></div></div>');
            for (var chaveinterna in tableF[chave]) {
                count = count + 1;
                target.children('div.' + chave).children('div.btns').append('<button class="toggle-vis id'+chaveinterna+'" data-column="' + chaveinterna + '">' + tableF[chave][chaveinterna] + '</button>')
                if (count >= 9) {
                    storeFilters.push(chaveinterna);
                    //$('button.toggle-vis.id' + chaveinterna).trigger( "click" );
                }
                //htmlButtons += '<button class="toggle-vis" data-column="'+chave+'">'+chave+'</button>';
            }
        }
    };

    //target.children('div').children("div").append(htmlButtons);
}
function disableFilters() {
    //debugger;
    for (var chave in storeFilters) {
        $('button.toggle-vis.id' + storeFilters[chave]).trigger("click");
    }
}
function createTable(target, tableH, tableB, itemType){
    itemType = itemType;
    console.log("createtable");
    let htmlHead = '';
    let htmlBody = '';

    $.each(tableH, function(key, value){  // cria os Titulos  
        htmlHead += '<th>'+value+'</th>';
    });
    htmlHead += '<th class="btnDetalhes">Detalhes</th>';
    
    for(i=0;i < tableB.length; i++){
        htmlBody += '<tr class="id'+i+'">';
        for (var chave in tableB[i]) {
            chaveClass = chave.replace('/\\\//g', '');
            chaveClass = chave.replace("/", '');
            htmlBody += '<td class="'+chaveClass+'">'+tableB[i][chave]+'</td>';
        }
        htmlBody += '<td class="btnDetalhes"><button class="" id="id'+i+'" style="display:block;" tipo="'+itemType+'">Detalhes</button></td>';
        htmlBody += '</tr>';
    }
    if(target.children().length > 0){
        target.children().remove(); // limpa o elemento que será gerado a tabela.
    }
    target.append('<table id="finalTable"><thead><tr>'+htmlHead+'</tr></thead><tbody>'+htmlBody+'</tbody><tfoot></tfoot></table>');
    //target.append('<table id="finalTable"></table>');
    //console.log(tableH);
    //console.log(tableB);
    var dadosPM;
    dadosPM = $('.searchResult div.PMCard span:nth-of-type(1)').html();
    dadosPM += ' - ';
    dadosPM += $('.searchResult div.PMCard span:nth-of-type(2)').html();
    dadosPM += ' - ';
    dadosPM += $('.searchResult div.PMCard span:nth-of-type(3)').html();
    table = target.children('#finalTable').DataTable({
        //data: tableB,
        //columns: tableH,
        /*"columnDefs": [
            { "visible": false, "targets": "_all" }
        ],*/
        /*"paging": true,*/
        "lengthMenu": [10, 25, 50, 75, 100],
        "ordering": true,
        'dom': 'lfrtip',
        "info": true,
        "autoWidth": false,
        "lengthChange": true,
        "responsive": true,
        "scrollX": true,
        "language": {
            "search": "",
            "lengthMenu": "Mostrar _MENU_ resultados por pagina",
            "zeroRecords": "Zero registros encontados",
            "info": "Página <input type='text' placeholder='_PAGE_' onchange='pageNav($(this).val())'> de _PAGES_ - Total: <b>_TOTAL_</b> registros ",
            "infoEmpty": "Nenhum registro encontrado",
            "infoFiltered": "(filtrado de _MAX_ registros totais)",
            "paginate": {
                "first": "Primeiro",
                "last": "Último",
                "next": "Próximo",
                "previous": "Anterior"
            },
        },
        dom: 'Bfrtip',
        buttons: [
            
            { 
                extend: 'excel',
                messageTop: dadosPM,/*
                messageBottom: "Informações Abaixo",*/
                text: "Exportar Excel",
                exportOptions :{
                    columns: ':visible'
                }
            },
            {
                extend: 'pdfHtml5',
                messageTop: dadosPM,/*
                messageBottom: "Informações Abaixo",*/
                text: "Exportar PDF",
                orientation: 'landscape',
                pageSize: 'LEGAL',
                exportOptions: {
                    columns: ':visible'
                }
            }

        ]
    });
    $('.apdBtns').children().remove();
    table.buttons().container().appendTo('.apdBtns');

}
function pageNumChange(qtde){
    table.page.len(qtde).draw();
}
function pageNav(pagNum) {
    pagNum = parseInt(pagNum, 10)
    table.page(pagNum-1).draw('page');
}


$(document).on('click', 'button.toggle-vis', function(e){
//$('button.toggle-vis').on( 'click', function (e) {
    e.preventDefault();
    let checkLast = $('button.toggle-vis').length - $('button.toggle-vis.Filtered').length;
    if(checkLast > 1 || $(this).hasClass('Filtered')){
        let btnData = $(this).attr('data-column');
        // Get the column API object
        var column = table.column( btnData );

        // Toggle the visibility
        column.visible( ! column.visible() );

        //$(this).toggleClass('Filtered');
        $('button.toggle-vis[data-column="'+btnData+'"]').toggleClass('Filtered');
    } else{
    }
} );
$(document).on('click', '.tableFilterBtn > div > span', function(e){
//$('.tableFilterBtn > div > span').on( 'click', function (e) {
    let inativos = $('button.toggle-vis.Filtered').length;
    let todos = $('button.toggle-vis').length;
    let todos_coluna = $(this).next('div').children('button.toggle-vis').length;
    let inativos_coluna = $(this).next('div').children('button.toggle-vis.Filtered').length;
    let inatodos = (todos_coluna - inativos_coluna) + inativos;

    console.log('inativos:' + inativos);
    console.log('Todos:' + todos);
    console.log('todos_coluna:' + todos_coluna);
    console.log('inativos_coluna:' + inativos_coluna);
    console.log('inatodos:' + inatodos);
    if(inatodos == todos){
        console.log('FAIL');
    } else {
        let toggled = $(this).attr('toggled');
        let thisButtonsFiltered = $(this).next('div').children('button.Filtered');
        let thisButtons = $(this).next('div').children('button');
        thisButtonsFiltered.click();
        if(toggled === "0"){
            thisButtons.click();
            thisButtons.addClass('Filtered');
            $(this).attr('toggled','1');
        } else {
            thisButtons.removeClass('Filtered');
            $(this).attr('toggled','0');
        }
    }
});


$(document).on('click', 'td.Coordenada', function(){
    //alert('COORDENADA');
    var latlong = $(this).text();
    var result = latlong.match(/[^,]+,[^,]+/g);
    result[0] = parseFloat(result[0]);
    result[1] = parseFloat(result[1]);

    console.log(result);
    var Opcoes = {
        zoom: 15,
        center: new google.maps.LatLng(result[0], result[1]),
        mapTypeId: google.maps.MapTypeId.ROADMAP
    }
    var map = new google.maps.Map(document.getElementById("map"), Opcoes);
    $('.boxMap').show();
    $('.darkBgMap').show();
});
$(document).on('click', '.darkBgMap', function(){
    $('.boxMap').hide();
    $('.darkBgMap').hide();
});
$(document).on('click', '.boxMap .close', function(){
    $('.boxMap').hide();
    $('.darkBgMap').hide();
});